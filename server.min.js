/*! angular-seed-master 2013-05-22 */
function ensureAuthentication(e,n,o){return e.user?o():n.send(401)}var port=1337,express=require("express"),bcrypt=require("bcrypt-nodejs"),handlers=require("./node/handlers"),passport=require("passport"),LocalStrategy=require("passport-local").Strategy,fs=require("fs"),http=require("http");passport.serializeUser(function(e,n){n(null,e._id)}),passport.deserializeUser(function(e,n){handlers.findById(e,function(e,o){n(e,o)})}),passport.use(new LocalStrategy(function(e,n,o){console.log("Auth: ",e,n),handlers.findByUsername(e,function(e,t){return e?o(e):t?bcrypt.compareSync(n,t.password)?o(null,t):o(null,!1,{errPassword:!0}):o(null,!1,{errUser:!0})})}));var privateKey=""+fs.readFileSync("key/ssl.key"),certificate=""+fs.readFileSync("key/ssl.crt"),app=express();app.use(express.static(__dirname+"/app")),app.use(express.cookieParser()),app.use(express.session({secret:"keyboard cat"})),app.use(passport.initialize()),app.use(passport.session()),app.use(express.bodyParser()),app.get("/favicon.ico",function(e,n){n.send(403)}),app.get("/api/test1",handlers.test1),app.get("/api/user",ensureAuthentication,handlers.userInfo),app.get("/api/user/fname/:fname",handlers.findUserByFname),app.get("/api/user/age/:age",handlers.findUserByAge),app.get("/api/user/logout",handlers.userLogout),app.get("/api/user/delete",handlers.userDelete),app.get("api/user/clear",handlers.clearDatabase),app.post("/api/user/login",function(e,n,o){passport.authenticate("local",function(t,r,s){return t?o(t):r?(e.login(r,function(e){return e?o(e):(console.log("User logged in"),n.send(200,{username:r.username}))}),void 0):n.send(401,s)})(e,n,o)}),app.get("/api/user/checkSession",ensureAuthentication,handlers.checkSession),app.get("*",handlers.index),app.post("/api/user/create",handlers.createUser),app.listen(port),console.log("Listening on port %d.",port);